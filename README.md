# Udacity Blockchain Capstone

The capstone will build upon the knowledge you have gained in the course in order to build a decentralized housing product.

# Contract Addresses

1. ERC721MintableComplete: [0x600Ee1603d7c6670cF5D6aCA2b2F5B1C102336c6](https://rinkeby.etherscan.io/address/0x600Ee1603d7c6670cF5D6aCA2b2F5B1C102336c6)
2. SquareVerifier: [0x7F846064815D9Cbf5827ABf69304FC3AB4B47Bdd](https://rinkeby.etherscan.io/address/0x7F846064815D9Cbf5827ABf69304FC3AB4B47Bdd)
3. SolnSquareVerifier: [0x5dd8f4eabc119343777734efa82b5b53a66ce035](https://rinkeby.etherscan.io/address/0x5dd8f4eabc119343777734efa82b5b53a66ce035)

# Contract ABIs

1. ERC721MintableComplete: [eth-contracts/build/contracts/ERC721MintableComplete.json](eth-contracts/build/contracts/ERC721MintableComplete.json)
2. SquareVerifier: [eth-contracts/build/contracts/SquareVerifier.json](eth-contracts/build/contracts/SquareVerifier.json)
3. SolnSquareVerifier: [eth-contracts/build/contracts/SolnSquareVerifier.json](eth-contracts/build/contracts/SolnSquareVerifier.json)

# MarketPlace Storefront and tokens links
- Storefront: https://testnets.opensea.io/collection/brian-udacity-token
- Token1: https://testnets.opensea.io/assets/0x5dd8f4eabc119343777734efa82b5b53a66ce035/1
- Token2: https://testnets.opensea.io/assets/0x5dd8f4eabc119343777734efa82b5b53a66ce035/2
- Token3: https://testnets.opensea.io/assets/0x5dd8f4eabc119343777734efa82b5b53a66ce035/3
- Token4: https://testnets.opensea.io/assets/0x5dd8f4eabc119343777734efa82b5b53a66ce035/4
- Token5: https://testnets.opensea.io/assets/0x5dd8f4eabc119343777734efa82b5b53a66ce035/5
- Token6: https://testnets.opensea.io/assets/0x5dd8f4eabc119343777734efa82b5b53a66ce035/6
- Token7: https://testnets.opensea.io/assets/0x5dd8f4eabc119343777734efa82b5b53a66ce035/7
- Token8: https://testnets.opensea.io/assets/0x5dd8f4eabc119343777734efa82b5b53a66ce035/8
- Token9: https://testnets.opensea.io/assets/0x5dd8f4eabc119343777734efa82b5b53a66ce035/9
- Token10: https://testnets.opensea.io/assets/0x5dd8f4eabc119343777734efa82b5b53a66ce035/10

# ERC721 / ZoKrates tokens minted transactions

1. Token1's transaction: [0xd74236512473bf294f55e5dfd9443872c1d66d859e6000a490f868e84d37f464](https://rinkeby.etherscan.io/tx/0xd74236512473bf294f55e5dfd9443872c1d66d859e6000a490f868e84d37f464)
1. Token2's transaction: [0x0c538e4ae9c980b0e5060474f506f9e6f0168ab57bcfcee3c98f2c29865b86a6](https://rinkeby.etherscan.io/tx/0x0c538e4ae9c980b0e5060474f506f9e6f0168ab57bcfcee3c98f2c29865b86a6)
1. Token3's transaction: [0x3c1f2650688dc8600386f875600e97ad76ebd6e8ac4ffcb02a5da370bdb1e323](https://rinkeby.etherscan.io/tx/0x3c1f2650688dc8600386f875600e97ad76ebd6e8ac4ffcb02a5da370bdb1e323)
1. Token4's transaction: [0xf652a6d587349ea6fcd9231748daf9b739a2065e7a5591f95b5519d72e7c0d9e](https://rinkeby.etherscan.io/tx/0xf652a6d587349ea6fcd9231748daf9b739a2065e7a5591f95b5519d72e7c0d9e)
1. Token5's transaction: [0x478da6ee4e8b5e3c84ac5b8a642c64cb63b4c942e0741e307ddef5775c6da116](https://rinkeby.etherscan.io/tx/0x478da6ee4e8b5e3c84ac5b8a642c64cb63b4c942e0741e307ddef5775c6da116)
1. Token6's transaction: [0x3a128e5fb7e5cd936b69471ce130d8aca1943eab0737267e8803d21955eeecbc](https://rinkeby.etherscan.io/tx/0x3a128e5fb7e5cd936b69471ce130d8aca1943eab0737267e8803d21955eeecbc)
1. Token7's transaction: [0xe417986ea6873cb647cb05062bc75b109013354579b51f8dee6e6c8516830e68](https://rinkeby.etherscan.io/tx/0xe417986ea6873cb647cb05062bc75b109013354579b51f8dee6e6c8516830e68)
1. Token8's transaction: [0xcf0754217e0a7341ebe3a8e82ccc24ced48b61d7d4de2b5da413a6faef5e95f9](https://rinkeby.etherscan.io/tx/0xcf0754217e0a7341ebe3a8e82ccc24ced48b61d7d4de2b5da413a6faef5e95f9)
1. Token9's transaction: [0x4742138d0019375aaa1994b84104733c3c1d4ed111ca1761251bd92cd9130994](https://rinkeby.etherscan.io/tx/0x4742138d0019375aaa1994b84104733c3c1d4ed111ca1761251bd92cd9130994)
1. Token10's transaction: [0xdd7ed5a58a6bd0d68fec00535b456ab1fcc208a4f84bd520fa2202cb848fe485](https://rinkeby.etherscan.io/tx/0xdd7ed5a58a6bd0d68fec00535b456ab1fcc208a4f84bd520fa2202cb848fe485)


# Purchased Transactions
1. Buy token2: https://rinkeby.etherscan.io/tx/0x6ea543114553618111d32c2bd6a8674f04f7e61bf9b1bb6b2a306764388671a8
2. Buy token3: https://rinkeby.etherscan.io/tx/0xbc46a74720e0dbf138eed981d6bb8a8d8ace2dd5d7d1bd9ef1be5a0b4ab074b5
3. Buy token5: https://rinkeby.etherscan.io/tx/0xb5c6c20313a39d60c0b05b3fee4a5142b38a9db33b61cda98e7d93430db14deb
4. Buy token6: https://rinkeby.etherscan.io/tx/0x0f2bd631d37477179a2ab076abd03c67f3b38c8063779ce47021eed3dd994375
5. Place a bid for token 1:
    1. Convert 3 ETH to 3 wETH: https://rinkeby.etherscan.io/tx/0xf5f2777522b372309b9fb8bf5f50a16fb37709d83ffd380e08a3f7cf3c8f1a99
    2. Approve your WETH for transfers: https://rinkeby.etherscan.io/tx/0x7afc55ab75869ecc2b0a43fe9f1c60cccf485638ec3a2479c5bb811269c56ae3
    3. Place a bid with signed message
4. Accept the bid: for token1
    1. Approve your WETH for transfers: https://rinkeby.etherscan.io/tx/0x3465e8a394b696d014f8b4b0bf68d104de233aacc7ee10f0afd884e844a80cc5
    2. Accept the bid: https://rinkeby.etherscan.io/tx/0x4dc1e5f3faca753d2a7fff353e44ade148e9c036e66f7735460d412f879806da

# Versions

```bash
$ truffle version
Truffle v5.0.6 (core: 5.0.6)
Solidity - 0.5.2 (solc-js)
Node v11.15.0

$ npm -v
6.7.0

$ ganache-cli --version
Ganache CLI v6.12.2 (ganache-core: 2.13.2)
```
# Run tests

```
$ ganache-cli
$ cd eth-contracts
$ truffle test
```

# Run zkrates

```bash
# Setup docker
$ PROJ_PATH=<ABSOLUTE_PATH>
# PROJ_PATH=~/Code/Practices/Blockchain/Capstone
$ cd $PROJ_PATH
$ docker run -v $PROJ_PATH/zokrates/code:/home/zokrates/code -ti zokrates/zokrates:0.3.0 /bin/bash

# Run following command in the docker container

$ ~/zokrates -V # check the zokrates version is 0.3.0
ZoKrates 0.3.0

$ cd code/square

# compile
$ ~/zokrates compile -i square.code
# perform the setup phase
$ ~/zokrates setup
# execute the program
$ ~/zokrates compute-witness -a 337 113569 # proof1
# generate a proof of computation
$ ~/zokrates generate-proof
# export a solidity verifier
$ ~/zokrates export-verifier
$ mv proof.json proof1.json
$ mv witness witness1

# generate proof2
$ ~/zokrates compute-witness -a 3 9
$ ~/zokrates generate-proof
$ mv proof.json proof2.json
$ mv witness witness2

# generate proof3
$ ~/zokrates compute-witness -a 4 16
$ ~/zokrates generate-proof
$ mv proof.json proof3.json
$ mv witness witness3

# generate proof4
$ ~/zokrates compute-witness -a 5 25
$ ~/zokrates generate-proof
$ mv proof.json proof4.json
$ mv witness witness4

# generate proof5
$ ~/zokrates compute-witness -a 6 36
$ ~/zokrates generate-proof
$ mv proof.json proof5.json
$ mv witness witness5

# generate proof6
$ ~/zokrates compute-witness -a 7 49
$ ~/zokrates generate-proof
$ mv proof.json proof6.json
$ mv witness witness6

# generate proof7
$ ~/zokrates compute-witness -a 8 64
$ ~/zokrates generate-proof
$ mv proof.json proof7.json
$ mv witness witness7

# generate proof8
$ ~/zokrates compute-witness -a 9 81
$ ~/zokrates generate-proof
$ mv proof.json proof8.json
$ mv witness witness8

# generate proof9
$ ~/zokrates compute-witness -a 10 100
$ ~/zokrates generate-proof
$ mv proof.json proof9.json
$ mv witness witness9

# generate proof10
$ ~/zokrates compute-witness -a 11 121
$ ~/zokrates generate-proof
$ mv proof.json proof10.json
$ mv witness witness10

```

The generated verifier.sol is writted by `solidity ^0.4.14`. This project uses the Solidity 0.5.2, so the compile errors should be fixed to run the verifier.

# Deploy contracts

Create your `.secret.json` in `eth-contracts` folder
```json
{
  "infuraKey": "<Your infura key>",
  "walletPrivateKey": "<Your wallet private key>"
}
```


Transactions: https://rinkeby.etherscan.io/address/0xBa18eDC1eC2b709021A5aA78B0DB9b6585a3fa45

```bash
$ cd eth-contracts
$ truffle mirgrate --reset --network rinkeby

Compiling your contracts...
===========================
> Everything is up to date, there is nothing to compile.


Migrations dry-run (simulation)
===============================
> Network name:    'rinkeby-fork'
> Network id:      4
> Block gas limit: 29970705


1_initial_migration.js
======================

   Deploying 'Migrations'
   ----------------------
   > account:             0xBa18eDC1eC2b709021A5aA78B0DB9b6585a3fa45
   > balance:             4.99741838
   > gas used:            258162
   > gas price:           10 gwei
   > value sent:          0 ETH
   > total cost:          0.00258162 ETH

   -------------------------------------
   > Total cost:          0.00258162 ETH


2_deploy_contracts.js
=====================

   Deploying 'ERC721MintableComplete'
   ----------------------------------
   > account:             0xBa18eDC1eC2b709021A5aA78B0DB9b6585a3fa45
   > balance:             4.96474087
   > gas used:            3240723
   > gas price:           10 gwei
   > value sent:          0 ETH
   > total cost:          0.03240723 ETH


   Deploying 'SquareVerifier'
   --------------------------
   > account:             0xBa18eDC1eC2b709021A5aA78B0DB9b6585a3fa45
   > balance:             4.94699089
   > gas used:            1774998
   > gas price:           10 gwei
   > value sent:          0 ETH
   > total cost:          0.01774998 ETH

   -------------------------------------
   > Total cost:          0.05015721 ETH


Summary
=======
> Total deployments:   3
> Final cost:          0.05273883 ETH


Starting migrations...
======================
> Network name:    'rinkeby'
> Network id:      4
> Block gas limit: 29999943


1_initial_migration.js
======================

   Deploying 'Migrations'
   ----------------------
   > transaction hash:    0x0c1a7e3a10b6e3bf711c763a9d88e761df4768221f0ec79821747911f9a85ebc
   > Blocks: 1            Seconds: 9
   > contract address:    0x625B1f80694bA1505cD21ACCB4CAF37A691f843B
   > account:             0xBa18eDC1eC2b709021A5aA78B0DB9b6585a3fa45
   > balance:             4.9976373
   > gas used:            236270
   > gas price:           10 gwei
   > value sent:          0 ETH
   > total cost:          0.0023627 ETH


   > Saving migration to chain.
   > Saving artifacts
   -------------------------------------
   > Total cost:           0.0023627 ETH


2_deploy_contracts.js
=====================

   Deploying 'ERC721MintableComplete'
   ----------------------------------
   > transaction hash:    0x1d71deac6073f824ec0f7379d6bbe0413ca2d1e17e509ad727dcc2d59229b2db
   > Blocks: 1            Seconds: 9
   > contract address:    0x600Ee1603d7c6670cF5D6aCA2b2F5B1C102336c6
   > account:             0xBa18eDC1eC2b709021A5aA78B0DB9b6585a3fa45
   > balance:             4.96913175
   > gas used:            2804787
   > gas price:           10 gwei
   > value sent:          0 ETH
   > total cost:          0.02804787 ETH


   Deploying 'SquareVerifier'
   --------------------------
   > transaction hash:    0xcc7cbece1705aaf6bb6229cc76415acc7ef2c33002b2f43089937d8a1d6fd6f8
   > Blocks: 1            Seconds: 9
   > contract address:    0x7F846064815D9Cbf5827ABf69304FC3AB4B47Bdd
   > account:             0xBa18eDC1eC2b709021A5aA78B0DB9b6585a3fa45
   > balance:             4.95468013
   > gas used:            1445162
   > gas price:           10 gwei
   > value sent:          0 ETH
   > total cost:          0.01445162 ETH


   ⠙ Saving migration to chain.
   Deploying 'SolnSquareVerifier'
   ------------------------------
   ⠧ Saving migration to chain.   > transaction hash:    0x1fca0c4ec5e022cd67881dde46c2c78e08b3e4a7359b5a74e1cb2db039733cff
   > Saving migration to chain.
   > Saving artifacts
   -------------------------------------
   > Total cost:          0.04249949 ETH


Summary
=======
> Total deployments:   3
> Final cost:          0.04486219 ETH

   ⠸ Saving migration to chain.
```

# Mint tokens

Be sure that `.secret.json` is created, then executing following command to mint ERC-721 tokens:

```
$ node eth-contracts/mint-10-tokens.js
```


# Project Resources

* [Capstone: Real Estate Marketplace Project FAQ — Udacity Blockchain](https://andresaaap.medium.com/capstone-real-estate-marketplace-project-faq-udacity-blockchain-69fe13b4c14e)
* [Remix - Solidity IDE](https://remix.ethereum.org/)
* [Visual Studio Code](https://code.visualstudio.com/)
* [Truffle Framework](https://truffleframework.com/)
* [Ganache - One Click Blockchain](https://truffleframework.com/ganache)
* [Open Zeppelin ](https://openzeppelin.org/)
* [Interactive zero knowledge 3-colorability demonstration](http://web.mit.edu/~ezyang/Public/graph/svg.html)
* [Docker](https://docs.docker.com/install/)
* [ZoKrates](https://github.com/Zokrates/ZoKrates)
